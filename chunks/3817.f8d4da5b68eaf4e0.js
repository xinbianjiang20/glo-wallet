"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3817],{83817:function(e,t,s){Object.defineProperty(t,"__esModule",{value:!0}),t.SafeAppProvider=void 0;var a=s(39320);Object.defineProperty(t,"SafeAppProvider",{enumerable:!0,get:function(){return a.SafeAppProvider}})},39320:function(e,t,s){Object.defineProperty(t,"__esModule",{value:!0}),t.SafeAppProvider=void 0;const a=s(31764),r=s(17187),n=s(70077);class i extends r.EventEmitter{async connect(){this.emit("connect",{chainId:this.chainId})}async disconnect(){}get chainId(){return this.safe.chainId}async request(e){const{method:t,params:s=[]}=e;switch(t){case"eth_accounts":return[this.safe.safeAddress];case"net_version":case"eth_chainId":return(0,n.numberToHex)(this.chainId);case"personal_sign":{const[e,t]=s;if(this.safe.safeAddress.toLowerCase()!==t.toLowerCase())throw new Error("The address or message hash is invalid");const a=await this.sdk.txs.signMessage(e);return("signature"in a?a.signature:void 0)||"0x"}case"eth_sign":{const[e,t]=s;if(this.safe.safeAddress.toLowerCase()!==e.toLowerCase()||!t.startsWith("0x"))throw new Error("The address or message hash is invalid");const a=await this.sdk.txs.signMessage(t);return("signature"in a?a.signature:void 0)||"0x"}case"eth_signTypedData":case"eth_signTypedData_v4":{const[e,t]=s,a="string"===typeof t?JSON.parse(t):t;if(this.safe.safeAddress.toLowerCase()!==e.toLowerCase())throw new Error("The address is invalid");const r=await this.sdk.txs.signTypedMessage(a);return("signature"in r?r.signature:void 0)||"0x"}case"eth_sendTransaction":const t={...s[0],value:s[0].value||"0",data:s[0].data||"0x"};"string"===typeof t.gas&&t.gas.startsWith("0x")&&(t.gas=parseInt(t.gas,16));const l=await this.sdk.txs.send({txs:[t],params:{safeTxGas:t.gas}});return this.submittedTxs.set(l.safeTxHash,{from:this.safe.safeAddress,hash:l.safeTxHash,gas:0,gasPrice:"0x00",nonce:0,input:t.data,value:t.value,to:t.to,blockHash:null,blockNumber:null,transactionIndex:null}),l.safeTxHash;case"eth_blockNumber":return(await this.sdk.eth.getBlockByNumber(["latest"])).number;case"eth_getBalance":return this.sdk.eth.getBalance([(0,n.getLowerCase)(s[0]),s[1]]);case"eth_getCode":return this.sdk.eth.getCode([(0,n.getLowerCase)(s[0]),s[1]]);case"eth_getTransactionCount":return this.sdk.eth.getTransactionCount([(0,n.getLowerCase)(s[0]),s[1]]);case"eth_getStorageAt":return this.sdk.eth.getStorageAt([(0,n.getLowerCase)(s[0]),s[1],s[2]]);case"eth_getBlockByNumber":return this.sdk.eth.getBlockByNumber([s[0],s[1]]);case"eth_getBlockByHash":return this.sdk.eth.getBlockByHash([s[0],s[1]]);case"eth_getTransactionByHash":let g=s[0];try{g=(await this.sdk.txs.getBySafeTxHash(g)).txHash||g}catch(u){}return this.submittedTxs.has(g)?this.submittedTxs.get(g):this.sdk.eth.getTransactionByHash([g]).then((e=>(e&&(e.hash=s[0]),e)));case"eth_getTransactionReceipt":{let e=s[0];try{e=(await this.sdk.txs.getBySafeTxHash(e)).txHash||e}catch(u){}return this.sdk.eth.getTransactionReceipt([e]).then((e=>(e&&(e.transactionHash=s[0]),e)))}case"eth_estimateGas":return this.sdk.eth.getEstimateGas(s[0]);case"eth_call":return this.sdk.eth.call([s[0],s[1]]);case"eth_getLogs":return this.sdk.eth.getPastLogs([s[0]]);case"eth_gasPrice":return this.sdk.eth.getGasPrice();case"wallet_getPermissions":return this.sdk.wallet.getPermissions();case"wallet_requestPermissions":return this.sdk.wallet.requestPermissions(s[0]);case"safe_setSettings":return this.sdk.eth.setSafeSettings([s[0]]);case"wallet_sendCalls":{if(s[0].from!==this.safe.safeAddress)throw Error("Invalid from address");const e=s[0].calls.map(((e,t)=>{if(e.chainId!==(0,n.numberToHex)(this.chainId))throw new Error("Invalid call #".concat(t,": Safe is not on chain ").concat(e.chainId));if(!e.to)throw new Error("Invalid call #".concat(t,': missing "to" field'));var s,a;return{to:e.to,data:null!==(s=e.data)&&void 0!==s?s:"0x",value:null!==(a=e.value)&&void 0!==a?a:(0,n.numberToHex)(0)}})),{safeTxHash:t}=await this.sdk.txs.send({txs:e});return t}case"wallet_getCallsStatus":{var r,i,o,c;const e={[a.TransactionStatus.AWAITING_CONFIRMATIONS]:"PENDING",[a.TransactionStatus.AWAITING_EXECUTION]:"PENDING",[a.TransactionStatus.CANCELLED]:"CONFIRMED",[a.TransactionStatus.FAILED]:"CONFIRMED",[a.TransactionStatus.SUCCESS]:"CONFIRMED"},t=await this.sdk.txs.getBySafeTxHash(s[0]).catch((()=>null));if(!(null===t||void 0===t?void 0:t.txHash))throw new Error("Transaction not found");const u=await this.sdk.eth.getTransactionReceipt([t.txHash]).catch((()=>null));if(!u)throw new Error("Transaction receipt not found");var h;const l="multiSend"!==(null===(i=t.txData)||void 0===i||null===(r=i.dataDecoded)||void 0===r?void 0:r.method)?1:null!==(h=null===(c=t.txData.dataDecoded.parameters)||void 0===c||null===(o=c[0].valueDecoded)||void 0===o?void 0:o.length)&&void 0!==h?h:1,g=Number(u.blockNumber),f=Number(u.gasUsed);var d;const w=Array(l).fill({success:(0,n.numberToHex)(t.txStatus===a.TransactionStatus.SUCCESS?1:0),blockHash:u.blockHash,blockNumber:(0,n.numberToHex)(g),blockTimestamp:(0,n.numberToHex)(null!==(d=t.executedAt)&&void 0!==d?d:0),gasUsed:(0,n.numberToHex)(f),transactionHash:t.txHash,logs:u.logs});return{status:e[t.txStatus],receipts:w}}case"wallet_showCallsStatus":throw new Error('"'.concat(e.method,'" not supported'));case"wallet_getCapabilities":return{[(0,n.numberToHex)(this.chainId)]:{atomicBatch:{supported:!0}}};default:throw Error('"'.concat(e.method,'" not implemented'))}}send(e,t){e||t("Undefined request"),this.request(e).then((s=>t(null,{jsonrpc:"2.0",id:e.id,result:s}))).catch((e=>t(e,null)))}constructor(e,t){super(),this.submittedTxs=new Map,this.safe=e,this.sdk=t}}t.SafeAppProvider=i},70077:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.numberToHex=t.getLowerCase=void 0,t.getLowerCase=function(e){return e?e.toLowerCase():e},t.numberToHex=function(e){return"0x".concat(e.toString(16))}}}]);